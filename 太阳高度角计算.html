
<!-- saved from url=(0100)file:///C:/Users/X/Documents/js/%E5%A4%AA%E9%98%B3%E9%AB%98%E5%BA%A6%E8%A7%92%E8%AE%A1%E7%AE%97.html -->
<html lang="zh-cmn-Hans"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" href="style.css">
<title>太阳高度角计算器</title>
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style></head>
<body><div id="MathJax_Message" style="display: none;"></div>

<div class="container">


<div class="row">
<div class="col-md-9">


<div class="panel panel-black">

<div class="panel-body panel-app">

<form class="form-horizontal" name="theForm" action="javascript:compute();">
<div class="form-group">
<label class="col-sm-2 control-label">经度</label>
<div class="col-sm-6">
<div class="row">
<div class="col-sm-8">
<input onkeypress="return NoEnter()" maxlength="10" name="inputLongitude" class="form-control">
</div>
<div class="col-sm-4">
<select name="inputEastWest" class="form-control">
<option selected="selected">东</option>
<option>西</option>
</select>
</div>
</div>
</div>
</div>
<div class="form-group">
<label class="col-sm-2 control-label"> 选择时间制式 </label>
<div class="col-sm-6">
<div class="row">
<div class="col-sm-8">
<input onkeypress="return NoEnter()" maxlength="5" name="inputTime" class="form-control">
</div>
<div class="col-sm-4">
<select name="inputAMPM" class="form-control">
<option>上午</option>
<option>下午</option>
<option selected="selected">24 时制</option>
</select></div>
</div>
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">纬度</label>
<div class="col-sm-6">
<div class="row">
<div class="col-sm-8">
<input onkeypress="return NoEnter()" maxlength="10" name="inputLatitude" class="form-control"></div>
<div class="col-sm-4">
<select name="inputNorthSouth" class="form-control">
<option selected="">北</option>
<option>南</option>
</select>
</div>
</div>
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label"><span>选择时区</span></label>
<div class="col-sm-6">
<select name="inputTimeZone" class="form-control">
<option value="0">Z (GMT)</option>
<option value="1">A (GMT + 1:00)</option>
<option value="2">B (GMT + 2:00)</option>
<option value="3">C (GMT + 3:00)</option>
<option value="3.5"> C*(GMT + 3:30)</option>
<option value="4">D (GMT + 4:00)</option>
<option value="4.5">D* (GMT + 4:30)</option>
<option value="5">E (GMT + 5:00)</option>
<option value="5.5">E* (GMT + 5:30)</option>
<option value="6">F (GMT + 6:00)</option>
<option value="6.5">F* (GMT + 6:30)</option>
<option value="7">G (GMT + 7:00)</option>
<option value="8" selected=""> H (GMT + 8:00)</option>
<option value="9">I (GMT + 9:00)</option>
<option value="9.5">I* (GMT + 9:30)</option>
<option value="10">K (GMT + 10:00)</option>
<option value="10.5">K* (GMT + 10:30)</option>
<option value="11">L (GMT + 11:00)</option>
<option value="11.5"> L* (GMT + 11:30)</option>
<option value="12">M (GMT + 12:00)</option>
<option value="13">M* (GMT + 13:00)</option>
<option value="-1">N (GMT - 1:00)</option>
<option value="-2">O (GMT - 2:00)</option>
<option value="-3">P (GMT - 3:00)</option>
<option value="-3.5"> P* (GMT - 3:30)</option>
<option value="-4">Q (GMT - 4:00)</option>
<option value="-5">R (GMT - 5:00)</option>
<option value="-6">S (GMT - 6:00)</option>
<option value="-7">T (GMT - 7:00)</option>
<option value="-8">U (GMT - 8:00)</option>
<option value="-8.5"> U* (GMT - 8:30)</option>
<option value="-9">V (GMT - 9:00)</option>
<option value="-9.5"> V* (GMT - 9:30)</option>
<option value="-10">W (GMT - 10:00)</option>
<option value="-11">X (GMT - 11:00)</option>
<option value="-12">Y (GMT - 12:00)</option>
</select>
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">选择日期</label>
<div class="col-sm-6">
<div class="row">
<div class="col-sm-4">
<select name="inputYear" class="form-control">
<option>2000</option>
<option>2001</option>
<option>2002</option>
<option>2003</option>
<option>2004</option>
<option>2005</option>
<option>2006</option>
<option>2007</option>
<option>2008</option>
<option>2009</option>
<option>2010</option>
<option>2011</option>
<option>2012</option>
<option>2013</option>
<option>2014</option>
<option>2015</option>
<option selected="">2016</option>
<option>2017</option>
<option>2018</option>
<option>2019</option>
<option>2020</option>
<option>2021</option>
</select> 年
</div>
<div class="col-sm-4">
<select name="inputMonth" class="form-control">
<option selected="">1月</option>
<option>2月</option>
<option>3月</option>
<option>4月</option>
<option>5月</option>
<option>6月</option>
<option>7月</option>
<option>8月</option>
<option>9月</option>
<option>10月</option>
<option>11月</option>
<option>12月</option>
</select> 月
</div>
<div class="col-sm-4">
<select name="inputDate" class="form-control">
<option selected="">1</option>
<option>2</option>
<option>3</option>
<option>4</option>
<option>5</option>
<option>6</option>
<option>7</option>
<option>8</option>
<option>9</option>
<option>10</option>
<option>11</option>
<option>12</option>
<option>13</option>
<option>14</option>
<option>15</option>
<option>16</option>
<option>17</option>
<option>18</option>
<option>19</option>
<option>20</option>
<option>21</option>
<option>22</option>
<option>23</option>
<option>24</option>
<option>25</option>
<option>26</option>
<option>27</option>
<option>28</option>
<option>29</option>
<option>30</option>
<option>31</option>
</select> 日
</div>
</div>
</div>
</div>
<div class="form-group">
<label class="col-sm-2 control-label">选择基准时间</label>
<div class="col-sm-6">
<select name="inputTimeFormat" class="form-control">
<option>时钟时</option>
<option selected="">太阳时</option>
</select>
</div>
</div>
<div class="form-group">
<label class="col-sm-2 control-label"> 夏令时</label>
<div class="col-sm-6">
<select name="inputDaylight" class="form-control">
<option>是</option>
<option selected="">否</option>
</select>
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">海拔</label>
<div class="col-sm-6">
<div class="row">
<div class="col-sm-8">
<input onkeypress="return NoEnter()" maxlength="5" class="form-control" name="inputElevation">
</div>
<div class="col-sm-4">
<select name="inputFeetMeters" class="form-control">
<option selected=""> 米</option>
<option>英尺</option>
</select>
</div>
</div>
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">
零方位角</label>
<div class="col-sm-6">
<select name="inputZeroAzimuth" class="form-control">
<option value="0" selected="">南</option>
<option value="180">北</option>
</select></div>
</div>
<div class="form-group"><label class="col-sm-2 control-label"></label>
<div class="col-sm-6">
<input onclick="return CheckInputs();" type="submit" value=" 计算 " class="btn btn-primary"></div>
</div>
<hr>
<div class="form-group"><label class="col-sm-2 control-label">太阳高度角</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputAltitude" readonly="" class="form-control">
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">偏差</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputDeclination" readonly="" class="form-control"></div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">太阳方位角</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputAzimuth" readonly="" class="form-control">
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">时差</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputEOT" readonly="" class="form-control">
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">时钟时间</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputClockTime" readonly="" class="form-control"></div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">日出时间</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputSunrise" readonly="" class="form-control">
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">太阳时</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputLSOT" readonly="" class="form-control">
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">日落时间</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputSunset" readonly="" class="form-control">
</div>
</div>
<div class="form-group"><label class="col-sm-2 control-label">时角</label>
<div class="col-sm-6">
<input onkeypress="return NoEnter()" maxlength="10" size="10" name="outputHourAngle" readonly="" class="form-control"></div>
</div>
</form>

</div>


<div class="panel-body">
<canvas id="pychart" style="margin:1px;" height="0px"></canvas>
<h3 id="_1">使用说明</h3>
<p>本应用在地理学中经常会碰到。实现了在线计算<a href="http://www.yunsuan.org/wiki/%E5%A4%AA%E9%98%B3%E9%AB%98%E5%BA%A6%E8%A7%92">太阳高度角</a>与<a href="http://www.yunsuan.org/wiki/%E5%A4%AA%E9%98%B3%E6%96%B9%E4%BD%8D%E8%A7%92">太阳方位角</a>的功能。</p>
<p><img alt="太阳高度角立体图" src="6dfa04a4-f847-11e4-ba9a-00163e022551.gif"></p>
<p>方位角是以目标物（图中小房子）的正北方向为起算方向。计算旋转方式为：以目标物为轴心，以目标物的北方向为起始点，按顺时针方向旋转计算，一周，方位角逐步增大至360°。方位角的取值范围在0-360度。</p>
<p>太阳高度角（英语为altitude of the sun），有时也被简称为太阳高度，是指某地的太阳光线与当地地平面的所交的最小线面角，这是以太阳视盘面的几何中心和理想地平线所夹的角度。在现在生活中，太阳高度解不会超过90度。</p>
<h3 id="_2">注意事项</h3>
<p>在上面计算中，时间的输入，使用 06:08 ，或 0608 ，来表示6点8分。</p>
</div>


</div>
<div id="pycode"><script>

function PopUp(filename, windowName, type) {
switch (type) {
case 'medium':
parameters = "width=600,height=400,scrollbars=yes";
break;
case 'large':
parameters = "width=800,height=600,scrollbars=yes";
break;
}
window.open(filename, windowName, parameters);
windowName.focus();
}
/////////////////////////////////////////////
// sunangle.js
// Copyright 2006, 1995 Sustainable By Design
/////////////////////////////////////////////
///////////////////////////
// CHECK INPUTS FUNCTION //
///////////////////////////
function CheckInputs() {
var error = false;
var error_message = "注意！下面的输入必须予以纠正，才可以计算出太阳的角度:\n\n";
var f = document.theForm;
var inputLatitude = f.inputLatitude.value;
var inputLongitude = f.inputLongitude.value;
var inputTime = f.inputTime.value;
// LATITUDE
var latitudeOkay = false;
if (inputLatitude.search("^[0-9]+[dD][0-9]+[mM][0-9]+[sS]$") > -1) {
latitudeOkay = true;
}
else {
if ((inputLatitude >= 0 ) && (inputLatitude <= 90)) {
latitudeOkay = true;
}
}
if (!latitudeOkay) {
error_message = error_message + "* 纬度必须介于0到90度之间\n";
error = true;
}
// LONGITUDE
var longitudeOkay = false;
if (inputLongitude.search("^[0-9]+[dD][0-9]+[mM][0-9]+[sS]$") > -1) {
longitudeOkay = true;
}
else {
if ((inputLongitude >= 0 ) && (inputLongitude <= 360)) {
longitudeOkay = true;
}
}
if (!longitudeOkay) {
error_message = error_message + "* 经度必须介于0到360度之间\n";
error = true;
}
// TIME
if ((inputTime != '') && (inputTime.search("^[0-9]+:?[0-9][0-9]$") < 0)) {
error_message = error_message + "* 时间必须是XX:XX或XXXX格式,如12点10分，填12:10或1210 \n";
error = true;
}
// ALERT / RETURN
if (error == true) {
alert(error_message);
}
return (!error);
}
///////////////////////////
// MAIN COMPUTE FUNCTION //
///////////////////////////
function compute() {
if (CheckInputs()) {
var f = document.theForm;
// constants
var degreesToRadians = 3.1416 / 180.0000;
var radiansToDegrees = 180.0000 / 3.1416;
var feetToMeters = 1.0000 / 3.2800;
var degreeMinutesToDecimal = 1.0000 / 60.0000;
var degreeSecondsToDecimal = 1.0000 / 3600.0000;
// retrieve input values
var inputLongitude = f.inputLongitude.value;
var inputEastWest = f.inputEastWest.options[f.inputEastWest.selectedIndex].text;
var inputLatitude = f.inputLatitude.value;
var inputNorthSouth = f.inputNorthSouth.options[f.inputNorthSouth.selectedIndex].text;
var inputElevation = f.inputElevation.value;
var inputFeetMeters = f.inputFeetMeters.options[f.inputFeetMeters.selectedIndex].text;
var inputMonth = f.inputMonth.options[f.inputMonth.selectedIndex].text;
var inputDate = f.inputDate.options[f.inputDate.selectedIndex].text - 0;
var inputYear = f.inputYear.options[f.inputYear.selectedIndex].text - 0;
var inputTime = f.inputTime.value;
var inputAMPM = f.inputAMPM.options[f.inputAMPM.selectedIndex].text;
var inputTimeFormat = f.inputTimeFormat.options[f.inputTimeFormat.selectedIndex].text;
var inputTimeZone = f.inputTimeZone.options[f.inputTimeZone.selectedIndex].value - 0;
var inputDaylight = f.inputDaylight.options[f.inputDaylight.selectedIndex].text;
var inputZeroAzimuth = f.inputZeroAzimuth.options[f.inputZeroAzimuth.selectedIndex].value - 0;
// convert longitude and latitude to decimal from DMS if necessary
if (inputLongitude.indexOf("d") != -1) {
degMarker = inputLongitude.indexOf("d");
minMarker = inputLongitude.indexOf("m");
secMarker = inputLongitude.indexOf("s");
longitudeDeg = inputLongitude.substr(0, degMarker) - 0;
longitudeMin = inputLongitude.substr(degMarker + 1, minMarker - degMarker - 1) - 0;
longitudeSec = inputLongitude.substr(minMarker + 1, secMarker - minMarker - 1) - 0;
inputLongitude = longitudeDeg + (longitudeMin * degreeMinutesToDecimal) + (longitudeSec * degreeSecondsToDecimal);
}
else {
inputLongitude -= 0;
}
if (inputLatitude.indexOf("d") != -1) {
degMarker = inputLatitude.indexOf("d");
minMarker = inputLatitude.indexOf("m");
secMarker = inputLatitude.indexOf("s");
LatitudeDeg = inputLatitude.substr(0, degMarker) - 0;
LatitudeMin = inputLatitude.substr(degMarker + 1, minMarker - degMarker - 1) - 0;
LatitudeSec = inputLatitude.substr(minMarker + 1, secMarker - minMarker - 1) - 0;
inputLatitude = LatitudeDeg + (LatitudeMin * degreeMinutesToDecimal) + (LatitudeSec * degreeSecondsToDecimal);
}
else {
inputLatitude -= 0;
}
// check validity of input values
var validInputTime = true;
// avoid math errors due to latitude or longitude = 0
if ((inputLatitude == 0) && (f.inputLatitude.value.length > 0)) {
inputLatitude = 0.000000001;
}
if ((inputLongitude == 0) && (f.inputLongitude.value.length > 0)) {
inputLongitude = 0.000000001;
}
// check which input fields were filled in by user
var timeEntered = (inputTime != "");
var latitudeEntered = (inputLatitude != "");
var longitudeEntered = (inputLongitude != "");
// convert input strings to numbers
inputLatitude = inputLatitude - 0;
inputLongitude = inputLongitude - 0;
inputElevation = inputElevation - 0;
// determine time formats
var clockTimeInputMode = (inputTimeFormat == "时钟时");
var lsotInputMode = (inputTimeFormat == "太阳时");
// determine what's do-able
var doableDeclination = true;
var doableEOT = true;
var doableClockTime = ((longitudeEntered || clockTimeInputMode) && timeEntered);
var doableLSOT = ((longitudeEntered || lsotInputMode) && timeEntered);
var doableHourAngle = (longitudeEntered && timeEntered);
var doableSunRiseSet = (longitudeEntered && latitudeEntered);
var doableAltitude = (longitudeEntered && timeEntered && latitudeEntered);
var doableAzimuth = (longitudeEntered && timeEntered && latitudeEntered);
// //////////// //
// CALCULATIONS //
// //////////// //
// CONVERT UNITS
// longitude east-west adjustment
if (longitudeEntered) {
var signedLongitude = inputLongitude;
if (inputEastWest == "东") signedLongitude *= -1; // [0] = east, [1] = west
}
// latitude north-south adjustment
if (latitudeEntered) {
var signedLatitude = inputLatitude;
if (inputNorthSouth == "南") signedLatitude *= -1; // [0] = north, [1] = south
}
// calculate daylight savings time adjustment
var daylightAdjustment = 0;
if (inputDaylight == "Yes") daylightAdjustment = 1;
// convert elevation units if necessary
if (inputFeetMeters == "feet") {
inputElevation *= feetToMeters;
}
// set zero azimuth
zeroAzimuth = inputZeroAzimuth;
// local standard time meridian
var meridian = inputTimeZone * -15;
// CALCULATE TIMES
// convert input time to hours after midnight
if (validInputTime) {
// ...remove semicolon from time string if necessary
inputTime = RemoveSemicolon(inputTime);
// ...parse time input string and get hours and minutes
if (inputTime.length == 4) { // like "1234"
timeHours = inputTime.substring(0, 2) - 0;
timeMinutes = inputTime.substring(2, 4) - 0;
}
else { // like "123"
timeHours = inputTime.substring(0, 1) - 0;
timeMinutes = inputTime.substring(1, 3) - 0;
}
// ...adjust for AM/PM designation
if ((inputAMPM == "上午") && (timeHours == 12)) timeHours = 0;
if (inputAMPM == "下午") {
if (timeHours != 12) timeHours += 12;
}
// ...calculate clock minutes after midnight
var inputHoursAfterMidnight = timeHours + timeMinutes / 60.0;
var inputMinutesAfterMidnight = timeHours * 60.0 + timeMinutes;
}
// calculate Universal Time
var UT = 0.0;
if (validInputTime) {
UT = inputHoursAfterMidnight - inputTimeZone - daylightAdjustment;
}
var monthNum = (MonthStringToMonthNum(inputMonth)) - 0;
if (monthNum > 2) {
correctedYear = inputYear;
correctedMonth = monthNum - 3;
}
else {
correctedYear = inputYear - 1;
correctedMonth = monthNum + 9;
}
var t = ((UT / 24.0) + inputDate + Math.floor(30.6 * correctedMonth + 0.5) + Math.floor(365.25 * (correctedYear - 1976)) - 8707.5) / 36525.0;
var G = 357.528 + 35999.05 * t;
G = NormalizeTo360(G);
var C = (1.915 * Math.sin(G * degreesToRadians)) + (0.020 * Math.sin(2.0 * G * degreesToRadians));
var L = 280.460 + (36000.770 * t) + C;
L = NormalizeTo360(L);
var alpha = L - 2.466 * Math.sin(2.0 * L * degreesToRadians) + 0.053 * Math.sin(4.0 * L * degreesToRadians);
var GHA = UT * 15 - 180 - C + L - alpha;
GHA = NormalizeTo360(GHA);
var obliquity = 23.4393 - 0.013 * t;
var declination = Math.atan(Math.tan(obliquity * degreesToRadians) * Math.sin(alpha * degreesToRadians)) * radiansToDegrees;
f.outputDeclination.value = FormatFloatString(declination);
var eotAdjustment = (L - C - alpha) / 15.0; // EOT adjustment in hours
f.outputEOT.value = FormatFloatString(eotAdjustment);
if (doableLSOT || doableClockTime) {
var clockTimeToLSOTAdjustment = ((signedLongitude - meridian) / 15.0) - eotAdjustment + daylightAdjustment; // in hours
}
var solarHourAngle = 0;
if (clockTimeInputMode) {
solarHourAngle = GHA - signedLongitude;
}
else {
solarHourAngle = 15 * (inputHoursAfterMidnight - 12);
}
solarHourAngle = NormalizeTo180(solarHourAngle);
var apparentSolarTime = 0;
if (clockTimeInputMode) {
apparentSolarTime = NormalizeTo24(12 + solarHourAngle / 15.0);
}
else {
apparentSolarTime = inputHoursAfterMidnight;
}
if (doableLSOT) {
if (clockTimeInputMode) {
solarMinutesAfterMidnight = inputMinutesAfterMidnight - (clockTimeToLSOTAdjustment * 60.0);
var whichDay = 0;
if (solarMinutesAfterMidnight < 0) { // it's the day before
solarMinutesAfterMidnight += 24 * 60;
whichDay = -1;
}
if (solarMinutesAfterMidnight >= 24 * 60) { // it's the next day
solarMinutesAfterMidnight -= 24 * 60;
whichDay = 1;
}
}
else {
solarMinutesAfterMidnight = inputMinutesAfterMidnight;
whichDay = 0;
}
solarTime = MinutesToClockTime(solarMinutesAfterMidnight, inputAMPM);
if (whichDay == "-1") f.outputLSOT.value = solarTime + "-";
if (whichDay == "0") f.outputLSOT.value = solarTime;
if (whichDay == "1") f.outputLSOT.value = solarTime + "+";
}
else {
f.outputLSOT.value = "";
}
if (doableClockTime) {
var clockMinutesAfterMidnight = inputMinutesAfterMidnight;
if (lsotInputMode) {
clockMinutesAfterMidnight = inputMinutesAfterMidnight + (clockTimeToLSOTAdjustment * 60.0);
}
var whichDay = 0;
if (clockMinutesAfterMidnight < 0) { // it's the day before
clockMinutesAfterMidnight += 24 * 60;
whichDay = -1;
}
if (clockMinutesAfterMidnight >= 24 * 60) { // it's the next day
clockMinutesAfterMidnight -= 24 * 60;
whichDay = 1;
}
clockTime = MinutesToClockTime(clockMinutesAfterMidnight, inputAMPM);
if (whichDay == "-1") f.outputClockTime.value = clockTime + "-";
if (whichDay == "0") f.outputClockTime.value = clockTime;
if (whichDay == "1") f.outputClockTime.value = clockTime + "+";
}
else {
f.outputClockTime.value = "";
}
// hour angle
if (doableHourAngle) {
var hourAngle = (solarMinutesAfterMidnight - 12 * 60) / 4 * -1;
f.outputHourAngle.value = FormatFloatString(hourAngle);
}
else {
f.outputHourAngle.value = "";
}
// altitude angle
if (doableAltitude) {
var altitudeAngle = radiansToDegrees * ArcSin(
(Math.sin(signedLatitude * degreesToRadians) *
Math.sin(declination * degreesToRadians)) -
(Math.cos(signedLatitude * degreesToRadians) *
Math.cos(declination * degreesToRadians) *
Math.cos((solarHourAngle + 180) * degreesToRadians)));
f.outputAltitude.value = FormatFloatString(altitudeAngle);
}
else {
f.outputAltitude.value = "";
}
// azimuth angle
if (doableAzimuth) {
var preAzimuthAngle = radiansToDegrees * ArcCos(
(Math.cos(declination * degreesToRadians) *
((Math.cos(signedLatitude * degreesToRadians) *
Math.tan(declination * degreesToRadians)) +
(Math.sin(signedLatitude * degreesToRadians) *
Math.cos((solarHourAngle + 180) * degreesToRadians)))) /
Math.cos(altitudeAngle * degreesToRadians));
if ((hourAngle > 0) && (hourAngle < 180)) {
azimuthAngle = (360.0 - preAzimuthAngle) + (zeroAzimuth - 180.0);
}
else {
azimuthAngle = preAzimuthAngle + (zeroAzimuth - 180.0);
}
f.outputAzimuth.value = FormatFloatString(azimuthAngle);
}
else {
f.outputAzimuth.value = "";
}
// clock time of sunrise & sunset
if (doableSunRiseSet) {
var sunRiseSetLSoTMinutes = radiansToDegrees * ArcCos(-1.0 *
(Math.sin(signedLatitude * degreesToRadians) *
Math.sin(declination * degreesToRadians) -
Math.sin((-0.8333 - 0.0347 * Math.sqrt(inputElevation)) * degreesToRadians)) /
Math.cos(signedLatitude * degreesToRadians) /
Math.cos(declination * degreesToRadians)) * 4;
f.outputSunrise.value = MinutesToClockTime((12 * 60 - sunRiseSetLSoTMinutes + (clockTimeToLSOTAdjustment * 60)), inputAMPM);
f.outputSunset.value = MinutesToClockTime((12 * 60 + sunRiseSetLSoTMinutes + (clockTimeToLSOTAdjustment * 60)), inputAMPM);
}
else {
f.outputSunrise.value = "";
f.outputSunset.value = "";
}
}
// zero out form outputs if inputs were invalid
else {
var f = document.theForm;
f.outputAltitude.value = '';
f.outputAzimuth.value = '';
f.outputDeclination.value = '';
f.outputEOT.value = '';
f.outputClockTime.value = '';
f.outputSunrise.value = '';
f.outputSunset.value = '';
f.outputLSOT.value = '';
f.outputHourAngle.value = '';
}
}
////////////////////////////////////////////////////////////////////////////////////
// OTHER FUNCTIONS
////////////////////////////////////////////////////////////////////////////////////
function NoEnter() {
return !(window.event && window.event.keyCode == 13);
}
function ArcSin(theThing) {
return (Math.asin(theThing));
}
function ArcCos(theThing) {
return (Math.acos(theThing));
}
function MinutesToClockTime(totalMinutes, amPM) {
var theHours = Math.floor(totalMinutes / 60);
var theMinutes = Math.floor(totalMinutes % 60);
if (theMinutes < 10) theMinutes = "0" + theMinutes; // add leading "0" if necessary
if (amPM == "24 时制") {
if (theHours < 10) theHours = "0" + theHours; // add leading "0" if necessary
returnString = theHours + "" + theMinutes;
}
else {
if (theHours < 12) {
if (theHours == 0) theHours = 12;
returnString = theHours + ":" + theMinutes + "am";
}
else {
if (theHours == 12) theHours = 24;
returnString = (theHours - 12) + ":" + theMinutes + "pm"
}
}
return (returnString);
}
function NormalizeTo360(theThing) {
return (theThing - Math.floor(theThing / 360.0) * 360);
}
function NormalizeTo180(theThing) {
theThing = NormalizeTo360(theThing);
if (theThing > 180) {
theThing = theThing - 360;
}
return (theThing);
}
function NormalizeTo24(theThing) {
return (theThing - Math.floor(theThing / 24.0) * 24);
}
function MonthStringToDays(whichMonth) {
if (whichMonth == "1月") return (0);
if (whichMonth == "2月") return (31);
if (whichMonth == "3月") return (59);
if (whichMonth == "4月") return (90);
if (whichMonth == "5月") return (120);
if (whichMonth == "6月") return (151);
if (whichMonth == "7月") return (181);
if (whichMonth == "8月") return (212);
if (whichMonth == "9月") return (243);
if (whichMonth == "10月") return (273);
if (whichMonth == "11月") return (304);
if (whichMonth == "12月") return (334);
return ("Zeke the Solar Cat"); // you can't get here but I swear it made me do this
}
function MonthStringToMonthNum(whichMonth) {
if (whichMonth == "1月") return (1);
if (whichMonth == "2月") return (2);
if (whichMonth == "3月") return (3);
if (whichMonth == "4月") return (4);
if (whichMonth == "5月") return (5);
if (whichMonth == "6月") return (6);
if (whichMonth == "7月") return (7);
if (whichMonth == "8月") return (8);
if (whichMonth == "9月") return (9);
if (whichMonth == "10月") return (10);
if (whichMonth == "11月") return (11);
if (whichMonth == "12月") return (12);
return ("Zeke the Solar Cat"); // you can't get here but I swear it made me do this
}
function RemoveSemicolon(inputString) {
// if second or third character is a semicolon, remove it (need to
// do better error checking on input soon)
if (inputString.substring(1, 2) == ":") {
return (inputString.substring(0, 1) + inputString.substring(2, 4));
}
if (inputString.substring(2, 3) == ":") {
return (inputString.substring(0, 2) + inputString.substring(3, 5));
}
return (inputString);
}
function FormatFloatString(theInput) {
var negativeNumber = false;
if (theInput < 0) {
negativeNumber = true;
theInput *= -1;
}
integerPortion = Math.floor(theInput);
decimalPortion = Math.round(theInput * 100) % 100;
// added 7/17/99 to correct problem with 0.999 being rounded to 0.000 in decimal conversion:
if ((decimalPortion == 0) && ((theInput - integerPortion) > 0.5)) {
integerPortion += 1;
}
if (integerPortion < 10) {
integerPortionString = " " + integerPortion; // add a space at beginning if necessary
}
else{
integerPortionString = "" + integerPortion;
}
if (decimalPortion < 10) {
decimalPortionString = "0" + decimalPortion; // add a leading zero if necessary
}
else {
decimalPortionString = "" + decimalPortion;
}
if (negativeNumber == true) {
return ("-" + integerPortionString + "." + decimalPortionString);
}
else {
return (" " + integerPortionString + "." + decimalPortionString);
}
}
</script></div>
<script type="text/javascript">
var canvas = document.getElementById("pychart");
canvas.setAttribute('height', '0px');
</script>
</div>
</div>
</div>
</body></html>
